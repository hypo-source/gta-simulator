## 핵심 결론 4줄

1. **WebGL2 기본 + KTX2 텍스처 + 스트리밍**은 사실상 필수
2. 화면 회전(세로/가로)은 **“UI 레이아웃”과 “카메라 파라미터”를 분리**해서 처리
3. iOS는 메모리 터지면 조용히 리로드/크래시 → **언로드(dispose)·텍스처 예산**이 생명
4. NPC는 “많아 보이게” 하되 실제 AI는 근거리만 → **업데이트 주기 분할**

---

# 1일차 스타터 튜토리얼 (세팅부터 바로 실행까지)

## 1) 프로젝트 세팅

- Vite + TypeScript
- Babylon.js
- 목표: **“빈 월드 + 플레이어 + 카메라 + 터치 + 회전 대응”**까지

폴더 추천(최적화 전제):

- `src/app/` : 부팅, 캔버스, 리사이즈/회전
- `src/engine/` : Babylon 엔진/씬, 렌더 루프
- `src/world/` : 청크 스트리밍(로드/언로드)
- `src/npc/` : NPC 레벨(near/mid/far) + 스케줄러
- `src/ui/` : 터치 조이스틱/HUD(세로·가로 레이아웃)

---

## 2) 화면 회전 대응(세로/가로 지원) 설계

### 반드시 분리할 것

- **렌더 캔버스 크기/해상도 관리** (Engine 레벨)
- **UI 레이아웃** (UI 레벨)
- **카메라 파라미터(거리/시야각/오프셋)** (CameraController)

### 정책

- 회전 감지 → `onResize()` 한 곳에서만 처리
- UI는 “세로 모드 프리셋 / 가로 모드 프리셋” 두 세트
- 카메라는 가로일 때 FOV/거리 줄이고, 세로일 때 위아래 시야 확보(살짝 멀리)

> 이렇게 안 하면, 화면 회전 때 “조작감+카메라+UI”가 한꺼번에 깨져서 유지보수가 지옥입니다.

---

## 3) 모바일 성능 기본 세팅(특히 iOS)

### 렌더링 기본 정책(초기부터 박기)

- 해상도 스케일(기기 성능에 따라): 0.7~1.0 범위에서 시작
- 그림자/후처리: 기본 OFF (High 프리셋에서만 제한적)
- 텍스처: KTX2 우선(나중에 붙이면 큰일)

### 로딩 정책

- “첫 로딩”은 **캐릭터+근거리 청크 3×3만**
- 멀리는 로드하지 않음(첫 인상 프레임 유지가 핵심)

---

# 2~4일차: 월드 스트리밍 + 거리 컷 + LOD (도시 게임의 핵심)

## 4) 청크 스트리밍(그리드)

- 청크 크기: 64m로 시작
- 활성 반경:
  - Near: 1(3×3) = 상호작용/충돌/고퀄
  - Mid: 2(5×5) = 단순화
  - Far: 3(7×7) = 스카이라인(저폴리)

### 거리 컷(당신이 원한 “멀면 안 그린다”)

- **청크 단위 enable/disable**이 가장 싸고 효과 큼
- 오브젝트 단위 컬링은 “중요 오브젝트만” 적용 (전부 하면 CPU 오버헤드)

---

## 5) LOD & 인스턴싱(Thin Instances)

도시는 반복 소품이 많아서, 이게 프레임을 결정합니다.

- 가로등/표지판/울타리/나무: Thin Instances
- 건물: LOD 2~3단
- 멀리: 빌보드/초저폴리로 “도시 실루엣”만 유지

---

# 5~7일차: NPC 시스템(도시/NPC 핵심 설계)

## 6) NPC 3계층 설계(필수)

- Near NPC (0~20): 실제 AI/애니/회피
- Mid Crowd (20~200): 단순 경로 걷기(충돌 거의 없음)
- Far Fake (∞): 장식 수준(가끔 리셋만)

## 7) AI 업데이트 스케줄링(성능 핵심)

- Near: 로직 10~20Hz
- Mid: 2~5Hz
- Far: 0Hz(안함)

**렌더는 60fps라도, AI를 60fps로 돌릴 이유가 없습니다.**

---

# 2주차: “다양한 경험(콘텐츠)”을 싸게 늘리는 방법

## 8) 경험 시스템 추천(비용 대비 체감 큰 것)

- 장소 상호작용: 의자 앉기/자판기/문 열기/사진 찍기
- NPC 대화: 텍스트 기반(선택지/호감도)
- 미니 퀘스트: 배달/안내/수집/시간 제한
- 시간대 변화: 낮/밤 (조명 간단)
- 날씨: 비(파티클 최소)/안개(후처리 최소)

> 총격/복잡 물리 없이도 “할 거리”를 만들 수 있어서 모바일에 딱 맞아요.

---

# 품질 프리셋(세로/가로 + iOS/Android를 동시에 잡는 방법)

### Low (iPhone 구형/저가형 Android)

- 해상도 0.65~0.75
- 그림자 OFF
- NPC Near 10 / Mid 50
- Far 스카이라인만

### Mid

- 해상도 0.8~0.9
- 캐릭터만 약한 그림자(가능하면)
- NPC Near 20 / Mid 120

### High

- 해상도 1.0
- 제한적 그림자
- NPC Near 30 / Mid 200

---

# 바로 다음 단계(제가 여기서 “코드 뼈대”를 같이 잡아줄게요)

당장 시작하려면 1일차 템플릿을 **“그대로 붙여넣으면 돌아가는 구조”**로 잡는 게 좋아요.

확정만 해줘요(짧게):

1. **멀티플레이 필요 없음**(싱글) 맞죠?
2. 캐릭터는 **간단한 캡슐(대체 모델)**로 시작해도 괜찮나요? (나중에 glb로 교체)

답 주면, 다음 메시지에:

- Vite+TS+BJS 프로젝트 구조
- `App.ts`(부팅/회전/리사이즈)
- `Engine.ts`(렌더루프/성능 프리셋)
- `CameraController.ts`(세로/가로 파라미터)
- `ChunkWorld.ts`(3×3 스트리밍 스켈레톤)
- `TouchControls.ts`(세로/가로 UI 레이아웃)

이렇게 “최소 실행 코드”를 한 번에 드릴게요.

# 1일차 스타터 튜토리얼 (세팅부터 바로 실행까지)

## 1) 프로젝트 세팅

- Vite + TypeScript
- Babylon.js
- 목표: **“빈 월드 + 플레이어 + 카메라 + 터치 + 회전 대응”**까지

폴더 추천(최적화 전제):

- `src/app/` : 부팅, 캔버스, 리사이즈/회전
- `src/engine/` : Babylon 엔진/씬, 렌더 루프
- `src/world/` : 청크 스트리밍(로드/언로드)
- `src/npc/` : NPC 레벨(near/mid/far) + 스케줄러
- `src/ui/` : 터치 조이스틱/HUD(세로·가로 레이아웃)

---

## 2) 화면 회전 대응(세로/가로 지원) 설계

### 반드시 분리할 것

- **렌더 캔버스 크기/해상도 관리** (Engine 레벨)
- **UI 레이아웃** (UI 레벨)
- **카메라 파라미터(거리/시야각/오프셋)** (CameraController)

### 정책

- 회전 감지 → `onResize()` 한 곳에서만 처리
- UI는 “세로 모드 프리셋 / 가로 모드 프리셋” 두 세트
- 카메라는 가로일 때 FOV/거리 줄이고, 세로일 때 위아래 시야 확보(살짝 멀리)

> 이렇게 안 하면, 화면 회전 때 “조작감+카메라+UI”가 한꺼번에 깨져서 유지보수가 지옥입니다.

---

## 3) 모바일 성능 기본 세팅(특히 iOS)

### 렌더링 기본 정책(초기부터 박기)

- 해상도 스케일(기기 성능에 따라): 0.7~1.0 범위에서 시작
- 그림자/후처리: 기본 OFF (High 프리셋에서만 제한적)
- 텍스처: KTX2 우선(나중에 붙이면 큰일)

### 로딩 정책

- “첫 로딩”은 **캐릭터+근거리 청크 3×3만**
- 멀리는 로드하지 않음(첫 인상 프레임 유지가 핵심)

---

# 2~4일차: 월드 스트리밍 + 거리 컷 + LOD (도시 게임의 핵심)

## 4) 청크 스트리밍(그리드)

- 청크 크기: 64m로 시작
- 활성 반경:
  - Near: 1(3×3) = 상호작용/충돌/고퀄
  - Mid: 2(5×5) = 단순화
  - Far: 3(7×7) = 스카이라인(저폴리)

### 거리 컷(당신이 원한 “멀면 안 그린다”)

- **청크 단위 enable/disable**이 가장 싸고 효과 큼
- 오브젝트 단위 컬링은 “중요 오브젝트만” 적용 (전부 하면 CPU 오버헤드)

---

## 5) LOD & 인스턴싱(Thin Instances)

도시는 반복 소품이 많아서, 이게 프레임을 결정합니다.

- 가로등/표지판/울타리/나무: Thin Instances
- 건물: LOD 2~3단
- 멀리: 빌보드/초저폴리로 “도시 실루엣”만 유지

---

# 5~7일차: NPC 시스템(도시/NPC 핵심 설계)

## 6) NPC 3계층 설계(필수)

- Near NPC (0~20): 실제 AI/애니/회피
- Mid Crowd (20~200): 단순 경로 걷기(충돌 거의 없음)
- Far Fake (∞): 장식 수준(가끔 리셋만)

## 7) AI 업데이트 스케줄링(성능 핵심)

- Near: 로직 10~20Hz
- Mid: 2~5Hz
- Far: 0Hz(안함)

**렌더는 60fps라도, AI를 60fps로 돌릴 이유가 없습니다.**

---

# 2주차: “다양한 경험(콘텐츠)”을 싸게 늘리는 방법

## 8) 경험 시스템 추천(비용 대비 체감 큰 것)

- 장소 상호작용: 의자 앉기/자판기/문 열기/사진 찍기
- NPC 대화: 텍스트 기반(선택지/호감도)
- 미니 퀘스트: 배달/안내/수집/시간 제한
- 시간대 변화: 낮/밤 (조명 간단)
- 날씨: 비(파티클 최소)/안개(후처리 최소)

> 총격/복잡 물리 없이도 “할 거리”를 만들 수 있어서 모바일에 딱 맞아요.
.